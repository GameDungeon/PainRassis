#pragma once

#include "bitboard.h"

extern Bitboard BishopAttacks[64][1024];
extern Bitboard RookAttacks[64][4096];

void initRookMagicTable();
void initBishopMagicTable();

struct Magic
{
    Bitboard mask;
    Bitboard magic;
    unsigned int shift;
};

void GenerateMagics();

inline uint64_t getMagicIndex(const Magic &m, Bitboard blockers)
{
    return ((blockers * m.magic) >> (64 - m.shift)).bb;
}

// Regenerate with GenerateMagics

const Magic RookMagics[64] = {
  { 0x101010101017eULL, 0x2092020002120000ULL, 12 },
  { 0x202020202027cULL, 0x400001100015500ULL, 11 },
  { 0x404040404047aULL, 0x400000002004080ULL, 11 },
  { 0x8080808080876ULL, 0xe20024441010102ULL, 11 },
  { 0x1010101010106eULL, 0x60100001040800ULL, 11 },
  { 0x2020202020205eULL, 0x10004c0026400209ULL, 11 },
  { 0x4040404040403eULL, 0x4100000000000004ULL, 11 },
  { 0x8080808080807eULL, 0x4024005800000003ULL, 12 },
  { 0x1010101017e00ULL, 0x1113000100180842ULL, 11 },
  { 0x2020202027c00ULL, 0x100040960520ULL, 10 },
  { 0x4040404047a00ULL, 0xab0001007200010ULL, 10 },
  { 0x8080808087600ULL, 0x1000000000029ULL, 10 },
  { 0x10101010106e00ULL, 0x1000a020a0000ULL, 10 },
  { 0x20202020205e00ULL, 0x28050001044010ULL, 10 },
  { 0x40404040403e00ULL, 0x2004100400080ULL, 10 },
  { 0x80808080807e00ULL, 0x22008200000400ULL, 11 },
  { 0x10101017e0100ULL, 0x1028162802034000ULL, 11 },
  { 0x20202027c0200ULL, 0xc00090000104000ULL, 10 },
  { 0x40404047a0400ULL, 0x92210200a000000ULL, 10 },
  { 0x8080808760800ULL, 0x55082801010421ULL, 10 },
  { 0x101010106e1000ULL, 0x1080080000280000ULL, 10 },
  { 0x202020205e2000ULL, 0x2009400002000ULL, 10 },
  { 0x404040403e4000ULL, 0xa0488000001140ULL, 10 },
  { 0x808080807e8000ULL, 0x45220040800c0ULL, 11 },
  { 0x101017e010100ULL, 0x400020001ULL, 11 },
  { 0x202027c020200ULL, 0x40b2050209000050ULL, 10 },
  { 0x404047a040400ULL, 0xa000002004340ULL, 10 },
  { 0x8080876080800ULL, 0x40140002000140ULL, 10 },
  { 0x1010106e101000ULL, 0x2660000901000080ULL, 10 },
  { 0x2020205e202000ULL, 0x10242100484400c1ULL, 10 },
  { 0x4040403e404000ULL, 0x4000080102201842ULL, 10 },
  { 0x8080807e808000ULL, 0x408000212a21000ULL, 11 },
  { 0x1017e01010100ULL, 0x1040001500000ULL, 11 },
  { 0x2027c02020200ULL, 0x30aa420825b01ULL, 10 },
  { 0x4047a04040400ULL, 0x2240215a0528ULL, 10 },
  { 0x8087608080800ULL, 0x20008022803841ULL, 10 },
  { 0x10106e10101000ULL, 0x400004004000020ULL, 10 },
  { 0x20205e20202000ULL, 0x2000000a40001100ULL, 10 },
  { 0x40403e40404000ULL, 0xa0a000409102006ULL, 10 },
  { 0x80807e80808000ULL, 0x4212041112b21038ULL, 11 },
  { 0x17e0101010100ULL, 0x4404488201202000ULL, 11 },
  { 0x27c0202020200ULL, 0x4904000008080080ULL, 10 },
  { 0x47a0404040400ULL, 0x4000000400100180ULL, 10 },
  { 0x8760808080800ULL, 0x40000b4008000a01ULL, 10 },
  { 0x106e1010101000ULL, 0x108150140000ULL, 10 },
  { 0x205e2020202000ULL, 0xc20000103060a0eULL, 10 },
  { 0x403e4040404000ULL, 0x20080804100802ULL, 10 },
  { 0x807e8080808000ULL, 0x2040000010122000ULL, 11 },
  { 0x7e010101010100ULL, 0xca2044100220c0ULL, 11 },
  { 0x7c020202020200ULL, 0x4100004000000080ULL, 10 },
  { 0x7a040404040400ULL, 0x1000111601201080ULL, 10 },
  { 0x76080808080800ULL, 0x402010a1408030a0ULL, 10 },
  { 0x6e101010101000ULL, 0x88010100200020ULL, 10 },
  { 0x5e202020202000ULL, 0x400000500f000000ULL, 10 },
  { 0x3e404040404000ULL, 0x40080020041014ULL, 10 },
  { 0x7e808080808000ULL, 0x4020002024b00108ULL, 11 },
  { 0x7e01010101010100ULL, 0x24000c840920000ULL, 12 },
  { 0x7c02020202020200ULL, 0x1100040100000004ULL, 11 },
  { 0x7a04040404040400ULL, 0x28044100100ULL, 11 },
  { 0x7608080808080800ULL, 0x1000004010052ULL, 11 },
  { 0x6e10101010101000ULL, 0x218010201080044ULL, 11 },
  { 0x5e20202020202000ULL, 0x40c401000001008ULL, 11 },
  { 0x3e40404040404000ULL, 0x20000141008a2ULL, 11 },
  { 0x7e80808080808000ULL, 0x1200020008000010ULL, 12 },
};

const Magic BishopMagics[64] = {
  { 0x40201008040200ULL, 0x300008018820014ULL, 6 },
  { 0x402010080400ULL, 0x40254400a0c3044ULL, 5 },
  { 0x4020100a00ULL, 0x4c001800010801ULL, 5 },
  { 0x40221400ULL, 0x208481020040820ULL, 5 },
  { 0x2442800ULL, 0x14400004840ULL, 5 },
  { 0x204085000ULL, 0x102102b002020ULL, 5 },
  { 0x20408102000ULL, 0x871a220000ULL, 5 },
  { 0x2040810204000ULL, 0x420005003240ULL, 6 },
  { 0x20100804020000ULL, 0x825000642084210ULL, 5 },
  { 0x40201008040000ULL, 0x420102420e00ULL, 5 },
  { 0x4020100a0000ULL, 0xa24008802004812ULL, 5 },
  { 0x4022140000ULL, 0x504014240060900ULL, 5 },
  { 0x244280000ULL, 0x200010454020480ULL, 5 },
  { 0x20408500000ULL, 0x28002031000040ULL, 5 },
  { 0x2040810200000ULL, 0x204008004aa1000ULL, 5 },
  { 0x4081020400000ULL, 0x34008000032080ULL, 5 },
  { 0x10080402000200ULL, 0xa08012204003820ULL, 5 },
  { 0x20100804000400ULL, 0x2110000400104318ULL, 5 },
  { 0x4020100a000a00ULL, 0x9020000082002ULL, 7 },
  { 0x402214001400ULL, 0x4504002104020400ULL, 7 },
  { 0x24428002800ULL, 0x1000000003841005ULL, 7 },
  { 0x2040850005000ULL, 0x1220b8441000000ULL, 7 },
  { 0x4081020002000ULL, 0x13022014820090ULL, 5 },
  { 0x8102040004000ULL, 0x200281000001988ULL, 5 },
  { 0x8040200020400ULL, 0x1600410020006ULL, 5 },
  { 0x10080400040800ULL, 0x9004423200404cULL, 5 },
  { 0x20100a000a1000ULL, 0x42000a1000850204ULL, 7 },
  { 0x40221400142200ULL, 0x202a008001201204ULL, 9 },
  { 0x2442800284400ULL, 0x28040001010100ULL, 9 },
  { 0x4085000500800ULL, 0x480100300c00b0ULL, 7 },
  { 0x8102000201000ULL, 0x240041c804000020ULL, 5 },
  { 0x10204000402000ULL, 0x10214200012a6008ULL, 5 },
  { 0x4020002040800ULL, 0x44114b000000008ULL, 5 },
  { 0x8040004081000ULL, 0x60044080300c1000ULL, 5 },
  { 0x100a000a102000ULL, 0x2002000004062010ULL, 7 },
  { 0x22140014224000ULL, 0x48118005004800ULL, 9 },
  { 0x44280028440200ULL, 0x2040414020000002ULL, 9 },
  { 0x8500050080400ULL, 0x960000402005400ULL, 7 },
  { 0x10200020100800ULL, 0x4016280128100a2ULL, 5 },
  { 0x20400040201000ULL, 0x5002108904002014ULL, 5 },
  { 0x2000204081000ULL, 0x3884001328000100ULL, 5 },
  { 0x4000408102000ULL, 0x800021401400a28ULL, 5 },
  { 0xa000a10204000ULL, 0x1040000004000f08ULL, 7 },
  { 0x14001422400000ULL, 0x2300030000020c8ULL, 7 },
  { 0x28002844020000ULL, 0x20a0010028100440ULL, 7 },
  { 0x50005008040200ULL, 0x40008200440082ULL, 7 },
  { 0x20002010080400ULL, 0xc88580000504020ULL, 5 },
  { 0x40004020100800ULL, 0x2a13021100a0ULL, 5 },
  { 0x20408102000ULL, 0x20480842020130ULL, 5 },
  { 0x40810204000ULL, 0x2200006225064000ULL, 5 },
  { 0xa1020400000ULL, 0x2108000120084180ULL, 5 },
  { 0x142240000000ULL, 0x8222044281002ULL, 5 },
  { 0x284402000000ULL, 0x483400002121111ULL, 5 },
  { 0x500804020000ULL, 0x4120040090240ULL, 5 },
  { 0x201008040200ULL, 0x688285020420400ULL, 5 },
  { 0x402010080400ULL, 0x14026800404000ULL, 5 },
  { 0x2040810204000ULL, 0x5000121000690297ULL, 6 },
  { 0x4081020400000ULL, 0x88100128211002ULL, 5 },
  { 0xa102040000000ULL, 0x808100500c01028ULL, 5 },
  { 0x14224000000000ULL, 0x4120022140021400ULL, 5 },
  { 0x28440200000000ULL, 0x8011001205410ULL, 5 },
  { 0x50080402000000ULL, 0x405100100920ULL, 5 },
  { 0x20100804020000ULL, 0xc012007040000ULL, 5 },
  { 0x40201008040200ULL, 0x689001024012014ULL, 6 },
};